Update the existing voice connection and summarization feature of my bot to fix the following error:

‚ùå ABORT_ERR: "This operation was aborted" during VC connection.

---

### üß© GOAL

1. Fix all voice connection timeout or abort errors.  
2. Support stable joining for VC (even on slow networks like Replit).  
3. Add retry and validation logic before aborting.  
4. Continue supporting Hinglish transcription & MoM summarization.  
5. Work with Discord.js v14 and @discordjs/voice latest version.

---

### üß† SOLUTION BLUEPRINT

Replace your `connectToVC` logic with this robust version:

```js
const {
  joinVoiceChannel,
  getVoiceConnection,
  entersState,
  VoiceConnectionStatus,
} = require('@discordjs/voice');

async function connectToVC(channel) {
  const existing = getVoiceConnection(channel.guild.id);
  if (existing) return existing;

  let connection;
  try {
    connection = joinVoiceChannel({
      channelId: channel.id,
      guildId: channel.guild.id,
      adapterCreator: channel.guild.voiceAdapterCreator,
      selfDeaf: false,
      selfMute: false,
    });

    console.log("‚è≥ Attempting to connect to VC:", channel.name);

    // Wait for ready, but with error catch
    await Promise.race([
      entersState(connection, VoiceConnectionStatus.Ready, 20000),
      new Promise((_, reject) =>
        setTimeout(() => reject(new Error("Voice connection timeout")), 20000)
      ),
    ]);

    console.log("‚úÖ Connected successfully to VC!");
    return connection;
  } catch (err) {
    console.error("‚ùå Primary VC connection failed:", err.message);

    // Retry once with longer wait and fallback
    try {
      await new Promise(res => setTimeout(res, 5000));
      connection = joinVoiceChannel({
        channelId: channel.id,
        guildId: channel.guild.id,
        adapterCreator: channel.guild.voiceAdapterCreator,
        selfDeaf: false,
        selfMute: false,
      });
      await entersState(connection, VoiceConnectionStatus.Ready, 25000);
      console.log("‚úÖ Connected after retry!");
      return connection;
    } catch (retryErr) {
      console.error("üö® Final VC Connection Error:", retryErr);
      throw new Error("Unable to connect after retry ‚Äî check VC permissions or slow network.");
    }
  }
}
üîê BOT PERMISSION CHECK (before connect)
Add a validation before trying to join VC:

js
Copy code
if (!channel.joinable) {
  return interaction.reply("‚ùå I don‚Äôt have permission to join this voice channel.");
}
if (!channel.speakable) {
  return interaction.reply("‚ö†Ô∏è I can join but cannot speak ‚Äî please check my role permissions.");
}
üß† Hinglish Voice Transcription (Updated Whisper setup)
js
Copy code
const transcription = await openai.audio.transcriptions.create({
  file: fs.createReadStream("./audio.wav"),
  model: "whisper-1",
  language: "hi", // Whisper understands Hinglish automatically
});
Then summarize:

js
Copy code
const summaryPrompt = `
You are an AI summarizer. The input text may be in Hinglish (Hindi-English mix).
Generate "Minutes of Meeting" in Hinglish with the following structure:
1Ô∏è‚É£ Key Topics
2Ô∏è‚É£ Action Items
3Ô∏è‚É£ Decisions Taken
4Ô∏è‚É£ Casual Notes
`;

const geminiResponse = await fetch(
  "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=" + process.env.GEMINI_API_KEY,
  {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      contents: [{ parts: [{ text: transcription.text + summaryPrompt }] }],
    }),
  }
);
‚öôÔ∏è DEPENDENCIES
sql
Copy code
npm install discord.js @discordjs/voice prism-media ffmpeg-static openai node-fetch fs